<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - PigStyle Music</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/static/css/admin.css">
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <style>
        /* Shipping tab styles */
        .row-pending {
            background-color: #fff3cd !important;
        }
        
        .status-badge-warning {
            background-color: #ffc107;
            color: #856404;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .status-badge-success {
            background-color: #28a745;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .status-badge-secondary {
            background-color: #6c757d;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .btn-action {
            background: none;
            border: none;
            color: #007bff;
            cursor: pointer;
            padding: 5px;
            margin: 0 2px;
            border-radius: 4px;
            transition: all 0.2s;
        }
        
        .btn-action:hover {
            background: #f8f9fa;
            color: #0056b3;
        }
        
        .shipping-stats .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .shipping-stats .stat-card h3 {
            color: rgba(255,255,255,0.9);
            font-size: 14px;
            margin-bottom: 10px;
        }
        
        .shipping-stats .stat-card .stat-number {
            font-size: 32px;
            font-weight: bold;
            color: white;
        }

        /* Order details modal styles */
        .order-details-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .order-details-section {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
        }

        .order-details-section h5 {
            margin: 0 0 10px 0;
            color: #333;
            font-size: 14px;
            border-bottom: 1px solid #dee2e6;
            padding-bottom: 5px;
        }

        .order-details-section p {
            margin: 5px 0;
            color: #666;
            font-size: 13px;
        }

        .order-details-section strong {
            color: #333;
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-brand">
            <a href="/">PigStyle Music</a>
        </div>
        <div class="nav-links">
            <a href="/">Home</a>
            <a href="/catalog">Catalog</a>
            <a href="/streaming">Streaming</a>
            <a href="/consignment">Consignment</a>
            <a href="/dashboard">Dashboard</a>
            <div id="auth-section">
                <!-- Populated by app-config.js -->
            </div>
        </div>
    </nav>

    <div class="admin-container">
        <h1><i class="fas fa-cogs"></i> Admin Panel</h1>
        
        <div class="tab-container">
            <div class="tab" onclick="switchTab('add-edit-delete')">
                <i class="fas fa-edit"></i> Add/Edit/Delete
            </div>
            <div class="tab" onclick="switchTab('check-out')">
                <i class="fas fa-shopping-cart"></i> Check Out
            </div>
            <div class="tab" onclick="switchTab('receipts')">
                <i class="fas fa-receipt"></i> Receipts
            </div>
            <div class="tab" onclick="switchTab('consignors')">
                <i class="fas fa-users"></i> Consignors
            </div>
            <div class="tab" onclick="switchTab('artists')">
                <i class="fas fa-music"></i> Artists
            </div>
            <div class="tab" onclick="switchTab('genres')">
                <i class="fas fa-tags"></i> Genres
            </div>
            <div class="tab" onclick="switchTab('accessories')">
                <i class="fas fa-headphones"></i> Accessories
            </div>
            <div class="tab" onclick="switchTab('shipping')">
                <i class="fas fa-shipping-fast"></i> Shipping
            </div>
            <div class="tab" onclick="switchTab('admin-config')">
                <i class="fas fa-sliders-h"></i> Admin Config
            </div>
            <div class="tab" onclick="switchTab('price-tags')">
                <i class="fas fa-tags"></i> Print Price Tags
            </div>
        </div>
        
        <!-- Add/Edit/Delete Tab -->
        <div id="add-edit-delete-tab" class="tab-content active">
            <div class="inventory-container">
                <div class="stats-row">
                    <div class="stat-card">
                        <div class="stat-value" id="total-records">0</div>
                        <div class="stat-label">Total Records</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="commission-rate">20.0%</div>
                        <div class="stat-label">Commission Rate</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="store-fill">0%</div>
                        <div class="stat-label">Store Fill</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="last-added">--</div>
                        <div class="stat-label">Last Added</div>
                    </div>
                </div>

                <div class="search-section">
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="searchType" value="add" checked>
                            Add Item (Search Discogs)
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="searchType" value="edit">
                            Edit or Delete Item
                        </label>
                    </div>

                    <div class="search-options-row">
                        <div class="search-field-select">
                            <label for="searchField"><i class="fas fa-search"></i> Search by:</label>
                            <select id="searchField" class="search-field-select">
                                <option value="all">Barcode, Artist, or Title</option>
                                <option value="barcode">Barcode</option>
                                <option value="artist">Artist</option>
                                <option value="title">Title</option>
                            </select>
                        </div>
                        
                        <form class="search-form" id="searchForm">
                            <input type="text" 
                                   class="search-input" 
                                   id="searchInput" 
                                   placeholder="Enter search term...">
                            <div class="action-buttons">
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-search"></i> Search
                                </button>
                                <button type="button" class="btn btn-secondary" id="clearSearch">
                                    <i class="fas fa-times"></i> Clear
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <div id="results-container" class="results-container">
                    <div class="loading" id="default-loading">
                        <i class="fas fa-search"></i>
                        <p>Search for records to get started</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Check Out Tab -->
        <div id="check-out-tab" class="tab-content">
            <h2><i class="fas fa-shopping-cart"></i> Check Out</h2>
            
            <div class="terminal-management">
                <div class="terminal-header">
                    <h3><i class="fas fa-square"></i> Square Terminal Status</h3>
                    <button class="btn btn-secondary" onclick="refreshTerminals()">
                        <i class="fas fa-sync-alt"></i> Refresh Terminals
                    </button>
                </div>
                <div id="terminal-list" class="terminal-list">
                    <div style="text-align: center; padding: 20px; color: #666;">
                        <i class="fas fa-square" style="font-size: 24px; margin-bottom: 10px; color: #ccc;"></i>
                        <p>Click refresh to load available terminals</p>
                    </div>
                </div>
            </div>
            
            <!-- Custom Item Section -->
            <div class="custom-item-section" style="margin: 20px 0; padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 8px; color: white;">
                <h3 style="margin-bottom: 15px;"><i class="fas fa-plus-circle"></i> Add Custom Item</h3>
                <div style="display: flex; gap: 15px; flex-wrap: wrap; align-items: flex-end;">
                    <div style="flex: 2; min-width: 200px;">
                        <label for="custom-note" style="display: block; margin-bottom: 5px; font-size: 0.9rem;">Description/Note</label>
                        <input type="text" 
                               id="custom-note" 
                               class="search-input" 
                               placeholder="e.g., Gift card, Service, Donation..."
                               style="width: 100%; background: rgba(255,255,255,0.9);">
                    </div>
                    <div style="flex: 1; min-width: 150px;">
                        <label for="custom-price" style="display: block; margin-bottom: 5px; font-size: 0.9rem;">Price ($)</label>
                        <input type="number" 
                               id="custom-price" 
                               class="search-input" 
                               placeholder="0.00" 
                               min="0" 
                               step="0.01"
                               style="width: 100%; background: rgba(255,255,255,0.9);">
                    </div>
                    <div style="flex: 0 0 auto;">
                        <button class="btn btn-success" onclick="addCustomItemToCart()" style="height: 42px; padding: 0 25px; background: #ffd700; color: #333; border: none;">
                            <i class="fas fa-cart-plus"></i> Add to Cart
                        </button>
                    </div>
                </div>
                <p style="margin-top: 10px; font-size: 0.85rem; opacity: 0.9;">
                    <i class="fas fa-info-circle"></i> Add custom items like gift cards, services, or miscellaneous merchandise
                </p>
            </div>
            
            <div class="search-container">
                <div class="search-box">
                    <input type="text" id="search-query" class="search-input" 
                           placeholder="Search by barcode, title, artist, catalog number, or accessory description..." 
                           onkeypress="if(event.key === 'Enter') searchRecordsAndAccessories()">
                    <button class="btn btn-primary" onclick="searchRecordsAndAccessories()">
                        <i class="fas fa-search"></i> Search
                    </button>
                </div>
                
                <div class="search-filters">
                    <label class="search-filter-checkbox">
                        <input type="checkbox" id="filter-active" checked> 
                        <i class="fas fa-check-circle" style="color: #28a745;"></i> Active Only
                    </label>
                    <label class="search-filter-checkbox">
                        <input type="checkbox" id="filter-barcode"> 
                        <i class="fas fa-barcode"></i> Search Barcode Only
                    </label>
                    <span style="color: #666; margin-left: auto; display: flex; align-items: center;">
                        <i class="fas fa-info-circle"></i> 
                        <span style="margin-left: 5px;">Found <span id="search-result-count">0</span> results</span>
                    </span>
                </div>
            </div>
            
            <div id="checkout-status-message" class="status-message"></div>
            
            <div id="search-results-container">
                <div class="results-count" id="results-count-header">
                    Showing <span id="displayed-results">0</span> items
                </div>
                <div id="search-results" class="search-results">
                    <div style="text-align: center; padding: 40px; color: #666;">
                        <i class="fas fa-search" style="font-size: 48px; margin-bottom: 20px; color: #ccc;"></i>
                        <p>Enter a search term to find records or accessories</p>
                    </div>
                </div>
            </div>
            
            <div id="shopping-cart-section" class="cart-section" style="display: none;">
                <div class="cart-header">
                    <h3><i class="fas fa-shopping-cart"></i> Shopping Cart</h3>
                    <span id="cart-item-count" class="badge" style="background: #3498db; color: white; padding: 5px 10px; border-radius: 20px;">0 items</span>
                </div>
                
                <div id="cart-items" class="cart-items"></div>
                
                <!-- Discount Field -->
                <div class="discount-section" style="margin: 15px 0; padding: 15px; background: #f8f9fa; border-radius: 4px;">
                    <div style="display: flex; align-items: center; gap: 15px; flex-wrap: wrap;">
                        <div style="flex: 1;">
                            <label for="discount-amount" style="display: block; margin-bottom: 5px; font-weight: 500; color: #333;">
                                <i class="fas fa-tag"></i> Discount
                            </label>
                            <div style="display: flex; gap: 10px;">
                                <input type="number" 
                                       id="discount-amount" 
                                       class="discount-input" 
                                       placeholder="0.00" 
                                       min="0" 
                                       step="0.01"
                                       style="flex: 1; padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px;"
                                       oninput="updateCartWithDiscount()">
                                <select id="discount-type" 
                                        class="discount-type-select"
                                        style="width: 100px; padding: 8px; border: 1px solid #ddd; border-radius: 4px;"
                                        onchange="updateCartWithDiscount()">
                                    <option value="fixed">$ Fixed</option>
                                    <option value="percentage" selected>% Off</option>
                                </select>
                            </div>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-size: 12px; color: #666;">Discount Applied</div>
                            <div id="discount-display" style="font-weight: bold; color: #27ae60;">$0.00</div>
                        </div>
                    </div>
                    <div id="discount-error" style="color: #dc3545; font-size: 12px; margin-top: 5px; display: none;"></div>
                </div>
                
                <div class="cart-summary">
                    <div class="summary-row">
                        <span>Subtotal:</span>
                        <span id="cart-subtotal">$0.00</span>
                    </div>
                    <div class="summary-row" id="discount-row" style="display: none;">
                        <span>Discount:</span>
                        <span id="cart-discount" style="color: #27ae60;">-$0.00</span>
                    </div>
                    <div class="summary-row">
                        <span>Tax (<span id="tax-rate-display">0</span>%):</span>
                        <span id="cart-tax">$0.00</span>
                    </div>
                    <div class="summary-row total">
                        <span>Total:</span>
                        <span id="cart-total">$0.00</span>
                    </div>
                </div>
                
                <div class="cart-actions">
                    <button class="btn btn-secondary" onclick="clearCart()">
                        <i class="fas fa-times"></i> Clear Cart
                    </button>
                    <button class="btn btn-cash" onclick="showTenderModal()" id="checkout-cash-btn">
                        <i class="fas fa-money-bill-wave"></i> Cash
                    </button>
                    <button class="btn btn-square" onclick="processSquarePayment()" id="checkout-square-btn">
                        <i class="fas fa-square"></i> Square
                    </button>
                </div>
            </div>
            
            <div class="loading" id="checkout-loading">
                <div class="loading-spinner"></div>
                <p>Searching...</p>
            </div>
        </div>
        
        <!-- Receipts Tab -->
        <div id="receipts-tab" class="tab-content">
            <h2><i class="fas fa-receipt"></i> Receipt History</h2>
            
            <div class="receipt-stats" id="receipt-stats">
                <div class="receipt-stat-card">
                    <div class="receipt-stat-number" id="total-receipts">0</div>
                    <div class="receipt-stat-label">Total Receipts</div>
                </div>
                <div class="receipt-stat-card">
                    <div class="receipt-stat-number" id="total-receipts-sales">$0.00</div>
                    <div class="receipt-stat-label">Total Sales</div>
                </div>
                <div class="receipt-stat-card">
                    <div class="receipt-stat-number" id="total-receipts-tax">$0.00</div>
                    <div class="receipt-stat-label">Total Tax Collected</div>
                </div>
                <div class="receipt-stat-card">
                    <div class="receipt-stat-number" id="total-receipts-items">0</div>
                    <div class="receipt-stat-label">Items Sold</div>
                </div>
            </div>
            
            <div class="receipts-search">
                <h3><i class="fas fa-search"></i> Search Receipts</h3>
                <div class="date-range">
                    <div class="date-field">
                        <label for="receipt-start-date">From Date:</label>
                        <input type="date" id="receipt-start-date" class="date-input">
                    </div>
                    <div class="date-field">
                        <label for="receipt-end-date">To Date:</label>
                        <input type="date" id="receipt-end-date" class="date-input">
                    </div>
                    <div class="date-field">
                        <label for="receipt-search-query">Receipt # or Item:</label>
                        <input type="text" id="receipt-search-query" class="filter-select" placeholder="Search by artist, title, catalog #...">
                    </div>
                    <div class="filter-group">
                        <button class="btn btn-primary" onclick="searchReceipts()">
                            <i class="fas fa-search"></i> Search
                        </button>
                        <button class="btn btn-secondary" onclick="resetReceiptSearch()">
                            <i class="fas fa-undo"></i> Reset
                        </button>
                    </div>
                </div>
            </div>
            
            <div id="receipts-grid" class="receipts-grid">
                <!-- Receipts will be dynamically rendered here -->
            </div>
            
            <div class="loading" id="receipts-loading">
                <div class="loading-spinner"></div>
                <p>Loading receipts...</p>
            </div>
        </div>
        
        <!-- Consignors Tab -->
        <div id="consignors-tab" class="tab-content">
            <h2><i class="fas fa-users"></i> Consignor Management</h2>
            
            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                <p><strong>Commission Rate:</strong> <span id="commission-rate-display">Per Record</span>% (Admin gets <span id="admin-commission-display">Per Record</span>% of sale, Consignor gets <span id="consignor-commission-display">Per Record</span>%)</p>
            </div>
            
            <div class="stats-grid" style="margin-bottom: 20px;">
                <div class="stat-card">
                    <h3>Total Consignors</h3>
                    <p class="stat-number" id="total-consignors">0</p>
                </div>
                <div class="stat-card">
                    <h3>Total Owed to Consignors</h3>
                    <p class="stat-number" id="total-credit">$0.00</p>
                </div>
                <div class="stat-card">
                    <h3>Total Admin Commission</h3>
                    <p class="stat-number" id="admin-total-commission">$0.00</p>
                </div>
            </div>
            
            <div class="records-table-container">
                <table class="records-table" id="consignors-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Username</th>
                            <th>Initials</th>
                            <th>Owed Amount</th>
                            <th>Records Sold</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="consignors-body">
                        <tr><td colspan="6" style="text-align:center; padding:20px;">Loading consignors...</td></tr>
                    </tbody>
                </table>
            </div>
            
            <div id="payment-modal" class="modal-overlay" style="display:none;">
                <div class="modal-content" style="max-width:400px;">
                    <div class="modal-header">
                        <h3 class="modal-title">Pay Consignor</h3>
                        <button class="modal-close" onclick="closePaymentModal()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <p>Consignor: <strong id="payment-consignor-name"></strong></p>
                        <p>Amount Owed: <strong id="payment-amount">$0.00</strong></p>
                        <p>Are you sure you want to mark this amount as paid? This will clear their balance.</p>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="closePaymentModal()">Cancel</button>
                        <button class="btn btn-success" onclick="processPayment()">Confirm Payment</button>
                    </div>
                </div>
            </div>
            
            <div class="loading" id="consignors-loading" style="display:none;">
                <div class="loading-spinner"></div>
                <p>Processing...</p>
            </div>
        </div>
        
        <!-- Artists Tab -->
        <div id="artists-tab" class="tab-content">
            <h2><i class="fas fa-music"></i> Artists by Record Count</h2>
            
            <div class="filter-controls" style="margin-bottom: 20px;">
                <div class="filter-group">
                    <label for="artist-search"><i class="fas fa-search"></i> Search Artist:</label>
                    <input type="text" id="artist-search" class="filter-select" placeholder="Type to filter..." onkeyup="filterArtists()" style="width: 250px;">
                </div>
                <div class="filter-group">
                    <button class="btn btn-secondary" onclick="loadArtists()">
                        <i class="fas fa-sync-alt"></i> Refresh
                    </button>
                </div>
                <div class="filter-group" style="margin-left: auto;">
                    <span class="pagination-info">
                        Total Artists: <strong id="total-artists-count">0</strong>
                    </span>
                </div>
            </div>
            
            <div class="input-group" style="margin-bottom: 20px;">
                <label for="artist-batch-size"><i class="fas fa-sort-numeric-down"></i> Number of artists to print:</label>
                <input type="number" id="artist-batch-size" min="1" value="10">
                <small>Select the top artists by record count to print on price tag sheets</small>
            </div>
            
            <div class="records-table-container">
                <table class="records-table" id="artists-table">
                    <thead>
                        <tr>
                            <th><input type="checkbox" id="select-all-artists"></th>
                            <th>#</th>
                            <th>Artist Name</th>
                            <th>Record Count</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="artists-body">
                        <tr><td colspan="5" style="text-align:center; padding:40px;">
                            <i class="fas fa-music" style="font-size: 48px; margin-bottom: 20px; color: #ccc; display: block;"></i>
                            Loading artists...
                        </td></tr>
                    </tbody>
                </table>
            </div>
            
            <div class="pagination" id="artists-pagination" style="margin-top: 20px;">
                <button class="page-btn" onclick="goToArtistsPage('first')" id="artists-first-btn" disabled>
                    <i class="fas fa-angle-double-left"></i>
                </button>
                <button class="page-btn" onclick="goToArtistsPage('prev')" id="artists-prev-btn" disabled>
                    <i class="fas fa-angle-left"></i>
                </button>
                
                <span class="pagination-info">
                    Page <span id="artists-current-page">1</span> of <span id="artists-total-pages">1</span>
                </span>
                
                <button class="page-btn" onclick="goToArtistsPage('next')" id="artists-next-btn" disabled>
                    <i class="fas fa-angle-right"></i>
                </button>
                <button class="page-btn" onclick="goToArtistsPage('last')" id="artists-last-btn" disabled>
                    <i class="fas fa-angle-double-right"></i>
                </button>
                
                <div class="records-per-page">
                    <span>Show:</span>
                    <select id="artists-page-size" onchange="changeArtistsPageSize(parseInt(this.value))">
                        <option value="20">20</option>
                        <option value="50" selected>50</option>
                        <option value="100">100</option>
                    </select>
                </div>
            </div>
            
            <div class="action-buttons" style="margin-top: 20px;">
                <button class="btn btn-primary" onclick="loadArtists()">
                    <i class="fas fa-sync-alt"></i> Refresh Artists
                </button>
                <button class="btn btn-success" onclick="showPrintArtistsConfirmation()" id="print-artists-btn" disabled>
                    <i class="fas fa-print"></i> Print Selected Artists
                </button>
                <button class="btn btn-secondary" onclick="selectTopArtists()">
                    <i class="fas fa-check-square"></i> Select Top Artists
                </button>
                <button class="btn btn-secondary" onclick="selectAllArtistsOnPage()">
                    <i class="fas fa-check-double"></i> Select All on Page
                </button>
                <button class="btn btn-secondary" onclick="clearArtistSelection()">
                    <i class="fas fa-times-circle"></i> Clear Selection
                </button>
            </div>
            
            <div class="loading" id="artists-loading" style="display:none;">
                <div class="loading-spinner"></div>
                <p>Loading artists...</p>
            </div>
        </div>
        
        <!-- Genres Tab -->
        <div id="genres-tab" class="tab-content">
            <h2><i class="fas fa-tags"></i> Genre Mismatches</h2>
            
            <div class="info-message" style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                <i class="fas fa-info-circle"></i> This tab shows artists where the genre in the artist_genre table doesn't match the genre in individual records. Click the edit button to update the expected genre.
            </div>
            
            <div class="stats-grid" style="margin-bottom: 20px;">
                <div class="stat-card">
                    <h3>Total Artists with Mismatches</h3>
                    <p class="stat-number" id="total-mismatch-artists">0</p>
                </div>
                <div class="stat-card">
                    <h3>Total Mismatched Records</h3>
                    <p class="stat-number" id="total-mismatch-records">0</p>
                </div>
            </div>
            
            <div class="filter-controls" style="margin-bottom: 20px;">
                <div class="filter-group">
                    <label for="genre-mismatch-search"><i class="fas fa-search"></i> Search Artist:</label>
                    <input type="text" id="genre-mismatch-search" class="filter-select" placeholder="Type to filter..." onkeyup="filterGenreMismatches()" style="width: 250px;">
                </div>
                <div class="filter-group">
                    <label for="genre-filter-select"><i class="fas fa-filter"></i> Filter by Expected Genre:</label>
                    <select id="genre-filter-select" class="filter-select" onchange="filterGenreMismatches()" style="width: 200px;">
                        <option value="all">All Genres</option>
                    </select>
                </div>
                <div class="filter-group">
                    <button class="btn btn-secondary" onclick="loadGenreMismatches()">
                        <i class="fas fa-sync-alt"></i> Refresh
                    </button>
                </div>
            </div>
            
            <div id="genre-edit-modal" class="modal-overlay" style="display:none;">
                <div class="modal-content" style="max-width:500px;">
                    <div class="modal-header">
                        <h3 class="modal-title"><i class="fas fa-edit"></i> Edit Expected Genre</h3>
                        <button class="modal-close" onclick="closeGenreEditModal()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <p>Artist: <strong id="edit-artist-name"></strong></p>
                        <div class="filter-group" style="margin-bottom: 15px;">
                            <label for="edit-genre-select">Expected Genre:</label>
                            <select id="edit-genre-select" class="filter-select" style="width: 100%;">
                                <!-- Genres will be populated here -->
                            </select>
                        </div>
                        <p class="info-message" style="background:#f8f9fa; padding:10px; border-radius:4px;">
                            <i class="fas fa-info-circle"></i> This will update the genre in the artist_genre table for all records by this artist.
                        </p>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="closeGenreEditModal()">Cancel</button>
                        <button class="btn btn-success" onclick="saveGenreEdit()" id="save-genre-btn">
                            <i class="fas fa-save"></i> Save Changes
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="records-table-container">
                <table class="records-table" id="genre-mismatches-table">
                    <thead>
                        <tr>
                            <th>Artist</th>
                            <th>Expected Genre (from artist_genre)</th>
                            <th>Records with Different Genres</th>
                            <th>Count</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="genre-mismatches-body">
                        <tr><td colspan="5" style="text-align:center; padding:40px;">
                            <i class="fas fa-tags" style="font-size: 48px; margin-bottom: 20px; color: #ccc; display: block;"></i>
                            Loading genre mismatches...
                        </td></tr>
                    </tbody>
                </table>
            </div>
            
            <div class="pagination" id="mismatches-pagination" style="margin-top: 20px;">
                <button class="page-btn" onclick="goToMismatchesPage('first')" id="mismatches-first-btn" disabled>
                    <i class="fas fa-angle-double-left"></i>
                </button>
                <button class="page-btn" onclick="goToMismatchesPage('prev')" id="mismatches-prev-btn" disabled>
                    <i class="fas fa-angle-left"></i>
                </button>
                
                <span class="pagination-info">
                    Page <span id="mismatches-current-page">1</span> of <span id="mismatches-total-pages">1</span>
                </span>
                
                <button class="page-btn" onclick="goToMismatchesPage('next')" id="mismatches-next-btn" disabled>
                    <i class="fas fa-angle-right"></i>
                </button>
                <button class="page-btn" onclick="goToMismatchesPage('last')" id="mismatches-last-btn" disabled>
                    <i class="fas fa-angle-double-right"></i>
                </button>
                
                <div class="records-per-page">
                    <span>Show:</span>
                    <select id="mismatches-page-size" onchange="changeMismatchesPageSize(parseInt(this.value))">
                        <option value="10">10</option>
                        <option value="25" selected>25</option>
                        <option value="50">50</option>
                    </select>
                </div>
            </div>
            
            <div class="loading" id="genres-loading" style="display:none;">
                <div class="loading-spinner"></div>
                <p>Loading genre mismatches...</p>
            </div>
        </div>

        <!-- Accessories Tab -->
        <div id="accessories-tab" class="tab-content">
            <h2><i class="fas fa-headphones"></i> Accessories Management</h2>
            
            <div class="accessory-form" id="accessory-form" style="display: none;">
                <h3 id="form-title"><i class="fas fa-plus-circle"></i> Add New Accessory</h3>
                <div class="accessory-form-grid">
                    <div>
                        <label for="accessory-description">Description *</label>
                        <input type="text" id="accessory-description" placeholder="e.g., Turntable Belt, RCA Cables" required>
                    </div>
                    <div>
                        <label for="accessory-price">Store Price *</label>
                        <input type="number" id="accessory-price" step="0.01" min="0" placeholder="0.00" required>
                    </div>
                    <div>
                        <label for="accessory-count">Initial Count (optional)</label>
                        <input type="number" id="accessory-count" min="0" value="0" placeholder="0">
                    </div>
                </div>
                <div class="action-buttons" style="justify-content: flex-start; margin-top: 10px;">
                    <button class="btn btn-success" onclick="saveAccessory()">
                        <i class="fas fa-save"></i> Save Accessory
                    </button>
                    <button class="btn btn-secondary" onclick="cancelAccessoryForm()">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                </div>
            </div>
            
            <div class="action-buttons" style="margin-bottom: 20px;" id="add-new-btn-container">
                <button class="btn btn-primary" onclick="showAddAccessoryForm()">
                    <i class="fas fa-plus"></i> Add New Accessory
                </button>
                <button class="btn btn-secondary" onclick="loadAccessories()">
                    <i class="fas fa-sync-alt"></i> Refresh
                </button>
                <button class="btn btn-success" onclick="printAccessoryBarcodes()">
                    <i class="fas fa-print"></i> Print Barcodes
                </button>
            </div>
            
            <div class="filter-controls" style="margin-bottom: 20px;">
                <div class="filter-group" style="flex: 1;">
                    <input type="text" id="accessory-search" class="filter-select" placeholder="Search by description or barcode..." onkeyup="filterAccessories()" style="width: 100%;">
                </div>
                <div class="filter-group">
                    <select id="stock-filter" class="filter-select" onchange="filterAccessories()">
                        <option value="all">All Stock</option>
                        <option value="low">Low Stock (&lt;=5)</option>
                        <option value="negative">Negative Stock</option>
                        <option value="in">In Stock (&gt;0)</option>
                    </select>
                </div>
            </div>
            
            <div class="accessories-table-container">
                <table class="accessories-table" id="accessories-table">
                    <thead>
                        <tr>
                            <th><input type="checkbox" id="select-all-accessories"></th>
                            <th>ID</th>
                            <th>Description</th>
                            <th>Barcode</th>
                            <th>Price</th>
                            <th>Count</th>
                            <th>Created</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="accessories-body">
                        <tr>
                            <td colspan="8" style="text-align: center; padding: 40px;">
                                <i class="fas fa-headphones" style="font-size: 48px; margin-bottom: 20px; color: #ccc; display: block;"></i>
                                Click "Add New Accessory" to get started
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <div class="action-buttons" style="margin-top: 20px;">
                <button class="btn btn-primary" onclick="loadAccessories()">
                    <i class="fas fa-sync-alt"></i> Refresh
                </button>
                <button class="btn btn-success" onclick="printAccessoryBarcodes()" id="print-accessories-btn" disabled>
                    <i class="fas fa-print"></i> Print Selected Barcodes
                </button>
                <button class="btn btn-secondary" onclick="selectAllAccessoriesOnPage()">
                    <i class="fas fa-check-double"></i> Select All on Page
                </button>
                <button class="btn btn-secondary" onclick="clearAccessorySelection()">
                    <i class="fas fa-times-circle"></i> Clear Selection
                </button>
            </div>
            
            <div class="loading" id="accessories-loading" style="display: none;">
                <div class="loading-spinner"></div>
                <p>Loading accessories...</p>
            </div>
        </div>

        <!-- Shipping Tab -->
        <div id="shipping-tab" class="tab-content">
            <h2><i class="fas fa-shipping-fast"></i> Shipping Queue</h2>
            
            <div class="shipping-stats" style="margin-bottom: 20px;">
                <div class="stats-grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));">
                    <div class="stat-card">
                        <h3><i class="fas fa-clock"></i> Pending Orders</h3>
                        <p class="stat-number" id="pending-shipping-count">0</p>
                    </div>
                    <div class="stat-card">
                        <h3><i class="fas fa-box"></i> Shipped Today</h3>
                        <p class="stat-number" id="shipped-today-count">0</p>
                    </div>
                    <div class="stat-card">
                        <h3><i class="fas fa-dollar-sign"></i> Total Revenue</h3>
                        <p class="stat-number" id="shipping-revenue">$0.00</p>
                    </div>
                </div>
            </div>
            
            <div class="filter-controls" style="margin-bottom: 20px;">
                <div class="filter-group">
                    <label for="shipping-status-filter"><i class="fas fa-filter"></i> Show:</label>
                    <select id="shipping-status-filter" class="filter-select" onchange="ShippingManager.loadOrders()" style="width: 200px;">
                        <option value="pending" selected>Pending Orders</option>
                        <option value="shipped">Shipped Orders</option>
                        <option value="all">All Orders</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="shipping-search"><i class="fas fa-search"></i> Search:</label>
                    <input type="text" id="shipping-search" class="filter-select" placeholder="Order #, Customer, Record..." style="width: 250px;">
                </div>
                <div class="filter-group">
                    <button class="btn btn-secondary" onclick="ShippingManager.loadOrders()">
                        <i class="fas fa-sync-alt"></i> Refresh
                    </button>
                    <button class="btn btn-primary" onclick="ShippingManager.exportShippingList()">
                        <i class="fas fa-download"></i> Export
                    </button>
                </div>
            </div>
            
            <div class="orders-container">
                <div class="records-table-container">
                    <table class="records-table" id="shipping-table">
                        <thead>
                            <tr>
                                <th>Order #</th>
                                <th>Date</th>
                                <th>Record</th>
                                <th>Customer</th>
                                <th>Shipping Address</th>
                                <th>Total</th>
                                <th>Status</th>
                                <th>Tracking</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="shipping-body">
                            <tr>
                                <td colspan="9" style="text-align: center; padding: 40px;">
                                    <i class="fas fa-shipping-fast" style="font-size: 48px; margin-bottom: 20px; color: #ccc; display: block;"></i>
                                    Loading orders...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="pagination" id="shipping-pagination" style="margin-top: 20px; display: none;">
                <button class="page-btn" onclick="ShippingManager.goToPage('first')" id="shipping-first-btn" disabled>
                    <i class="fas fa-angle-double-left"></i>
                </button>
                <button class="page-btn" onclick="ShippingManager.goToPage('prev')" id="shipping-prev-btn" disabled>
                    <i class="fas fa-angle-left"></i>
                </button>
                
                <span class="pagination-info">
                    Page <span id="shipping-current-page">1</span> of <span id="shipping-total-pages">1</span>
                </span>
                
                <button class="page-btn" onclick="ShippingManager.goToPage('next')" id="shipping-next-btn" disabled>
                    <i class="fas fa-angle-right"></i>
                </button>
                <button class="page-btn" onclick="ShippingManager.goToPage('last')" id="shipping-last-btn" disabled>
                    <i class="fas fa-angle-double-right"></i>
                </button>
                
                <div class="records-per-page">
                    <span>Show:</span>
                    <select id="shipping-page-size" onchange="ShippingManager.changePageSize(parseInt(this.value))">
                        <option value="20">20</option>
                        <option value="50" selected>50</option>
                        <option value="100">100</option>
                    </select>
                </div>
            </div>
            
            <div class="loading" id="shipping-loading" style="display: none;">
                <div class="loading-spinner"></div>
                <p>Loading orders...</p>
            </div>
        </div>
        
        <!-- Admin Config Tab -->
        <div id="admin-config-tab" class="tab-content">
            <h2><i class="fas fa-sliders-h"></i> Admin Configuration</h2>
            
            <div class="admin-config-section">
                <h3><i class="fas fa-print"></i> Print Settings</h3>
                <p>Configuration values related to price tag printing.</p>
                
                <div class="records-table-container">
                    <table class="records-table" id="print-config-table">
                        <thead>
                            <tr>
                                <th>Configuration Key</th>
                                <th>Value</th>
                                <th>Description</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="print-config-body">
                            <!-- Print config values will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="admin-config-section" style="margin-top: 30px;">
                <h3><i class="fas fa-cog"></i> General Settings</h3>
                <p>Other system configuration values.</p>
                
                <div class="records-table-container">
                    <table class="records-table" id="general-config-table">
                        <thead>
                            <tr>
                                <th>Configuration Key</th>
                                <th>Value</th>
                                <th>Description</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="general-config-body">
                            <!-- General config values will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="admin-config-section" style="margin-top: 30px;">
                <h3><i class="fas fa-plus-circle"></i> Add New Configuration</h3>
                
                <div class="add-config-form">
                    <div class="filter-group">
                        <label for="new-config-key">Key:</label>
                        <input type="text" id="new-config-key" class="config-value-input" placeholder="e.g., NEW_SETTING">
                    </div>
                    <div class="filter-group">
                        <label for="new-config-value">Value:</label>
                        <input type="text" id="new-config-value" class="config-value-input" placeholder="Enter value">
                    </div>
                    <div class="filter-group">
                        <label for="new-config-description">Description:</label>
                        <input type="text" id="new-config-description" class="config-value-input" placeholder="What does this setting do?">
                    </div>
                    <div class="filter-group">
                        <label>&nbsp;</label>
                        <button class="btn btn-success" onclick="addNewConfig()">
                            <i class="fas fa-plus"></i> Add Configuration
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="action-buttons" style="margin-top: 20px;">
                <button class="btn btn-primary" onclick="loadConfigTables()">
                    <i class="fas fa-sync-alt"></i> Refresh Config
                </button>
            </div>
        </div>

        <!-- Price Tags Tab -->
        <div id="price-tags-tab" class="tab-content">
            <h2><i class="fas fa-tags"></i> Print Price Tags</h2>
            
            <!-- Filter Controls -->
            <div class="filter-controls">
                <div class="filter-group">
                    <label for="user-select"><i class="fas fa-user"></i> Select User:</label>
                    <select id="user-select" class="select2 filter-select" style="width: 250px;">
                        <option value="all">All Users</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="status-filter"><i class="fas fa-filter"></i> Filter by Status:</label>
                    <select id="status-filter" class="filter-select" onchange="filterRecords()">
                        <option value="all">All Statuses</option>
                        <option value="inactive">Inactive Only</option>
                        <option value="active">Active Only</option>
                        <option value="sold">Sold Only</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <button class="btn btn-secondary" onclick="loadRecords()" style="height: 38px;">
                        <i class="fas fa-sync-alt"></i> Refresh
                    </button>
                </div>
            </div>
            
            <!-- Records Section -->
            <div id="records-section">
                <h3><i class="fas fa-list"></i> Records</h3>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>Total Records</h3>
                        <p class="stat-number" id="total-records-print">0</p>
                    </div>
                    <div class="stat-card">
                        <h3>Inactive Records</h3>
                        <p class="stat-number" id="inactive-records">0</p>
                    </div>
                    <div class="stat-card">
                        <h3>Active Records</h3>
                        <p class="stat-number" id="active-records">0</p>
                    </div>
                    <div class="stat-card">
                        <h3>Sold Records</h3>
                        <p class="stat-number" id="sold-records">0</p>
                    </div>
                    <div class="stat-card">
                        <h3>Selected Tags</h3>
                        <p class="stat-number" id="selected-tags">0</p>
                    </div>
                </div>
                
                <div class="input-group">
                    <label for="batch-size"><i class="fas fa-sort-numeric-down"></i> Number of tags to print:</label>
                    <input type="number" id="batch-size" min="1" value="10" onchange="selectRecentInactiveRecords()">
                    <small>Most recent inactive records will be selected (sorted by creation date descending)</small>
                </div>
                
                <div class="pagination" id="pagination-controls">
                    <button class="page-btn" onclick="goToFirstPage()" id="first-page-btn" disabled>
                        <i class="fas fa-angle-double-left"></i>
                    </button>
                    <button class="page-btn" onclick="goToPreviousPage()" id="prev-page-btn" disabled>
                        <i class="fas fa-angle-left"></i>
                    </button>
                    
                    <span class="pagination-info">
                        Page <input type="number" class="page-input" id="current-page" min="1" value="1" 
                               onchange="goToPage(parseInt(this.value))" onblur="goToPage(parseInt(this.value))"> 
                        of <span id="total-pages">1</span>
                    </span>
                    
                    <button class="page-btn" onclick="goToNextPage()" id="next-page-btn" disabled>
                        <i class="fas fa-angle-right"></i>
                    </button>
                    <button class="page-btn" onclick="goToLastPage()" id="last-page-btn" disabled>
                        <i class="fas fa-angle-double-right"></i>
                    </button>
                    
                    <div class="records-per-page">
                        <span>Show:</span>
                        <select id="page-size" onchange="changePageSize(parseInt(this.value))">
                            <option value="50">50</option>
                            <option value="100" selected>100</option>
                            <option value="200">200</option>
                            <option value="500">500</option>
                        </select>
                        <span>records per page</span>
                    </div>
                </div>
                
                <div class="records-table-container">
                    <table class="records-table" id="records-table">
                        <thead>
                            <tr>
                                <th><input type="checkbox" id="select-all"></th>
                                <th>#</th>
                                <th>Created Date <i class="fas fa-sort-down"></i></th>
                                <th>Artist</th>
                                <th>Title</th>
                                <th>Price</th>
                                <th>Catalog #</th>
                                <th>Genre</th>
                                <th>Barcode</th>
                                <th>Consignor</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="records-body">
                            <!-- Records will be loaded here -->
                        </tbody>
                    </table>
                </div>
                
                <div class="pagination" id="pagination-footer">
                    <span class="pagination-info">
                        Showing <span id="showing-start">0</span>-<span id="showing-end">0</span> 
                        of <span id="total-filtered">0</span> records
                        (<span id="selected-count">0</span> selected)
                    </span>
                </div>
                
                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="loadRecords()">
                        <i class="fas fa-sync-alt"></i> Refresh Records
                    </button>
                    <button class="btn btn-success" onclick="showPrintConfirmation()" id="print-btn" disabled>
                        <i class="fas fa-print"></i> Print Price Tags
                    </button>
                    <button class="btn btn-warning" onclick="showMarkActiveConfirmation()" id="mark-active-btn" disabled>
                        <i class="fas fa-check-circle"></i> Mark as Active
                    </button>
                    <button class="btn btn-secondary" onclick="selectRecentInactiveRecords()" id="select-inactive-btn">
                        <i class="fas fa-check-square"></i> Select Recent Inactive
                    </button>
                    <button class="btn btn-secondary" onclick="selectAllOnPage()">
                        <i class="fas fa-check-double"></i> Select All on Page
                    </button>
                    <button class="btn btn-secondary" onclick="clearSelection()">
                        <i class="fas fa-times-circle"></i> Clear Selection
                    </button>
                </div>
                
                <div id="status-message" class="status-message"></div>
                
                <div class="loading" id="loading">
                    <div class="loading-spinner"></div>
                    <p>Processing...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div id="print-confirmation-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fas fa-print"></i> Print Price Tags</h3>
                <button class="modal-close" onclick="closePrintConfirmation()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="print-summary">
                    <h4>Print Summary</h4>
                    <p>You are about to print price tags for <strong id="print-count">0</strong> selected records.</p>
                    <ul id="print-summary-list">
                        <!-- Will be populated dynamically -->
                    </ul>
                    <p>After printing successfully, you should mark these records as <strong>Active</strong> using the "Mark as Active" button.</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closePrintConfirmation()">Cancel</button>
                <button class="btn btn-success" onclick="confirmPrint()" id="confirm-print-btn">
                    <i class="fas fa-print"></i> Print Now
                </button>
            </div>
        </div>
    </div>

    <div id="mark-active-confirmation-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fas fa-check-circle"></i> Mark as Active</h3>
                <button class="modal-close" onclick="closeMarkActiveConfirmation()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="print-summary">
                    <h4>Confirmation Required</h4>
                    <p>You are about to mark <strong id="mark-active-count">0</strong> selected records as <strong>Active</strong>.</p>
                    <ul id="mark-active-summary-list">
                        <!-- Will be populated dynamically -->
                    </ul>
                    <p><strong>Important:</strong> Only mark records as Active <em>after</em> you have successfully printed their price tags.</p>
                    <p>This will change their status from "Inactive" to "Active" in the system.</p>
                </div>
                <div class="confirmation-check">
                    <input type="checkbox" id="mark-active-confirmation-check">
                    <label for="mark-active-confirmation-check">I have successfully printed price tags for these records</label>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeMarkActiveConfirmation()">Cancel</button>
                <button class="btn btn-warning" onclick="confirmMarkActive()" id="confirm-mark-active-btn" disabled>
                    <i class="fas fa-check-circle"></i> Mark as Active
                </button>
            </div>
        </div>
    </div>

    <div id="terminal-checkout-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fas fa-square"></i> Square Terminal Checkout</h3>
                <button class="modal-close" onclick="closeTerminalCheckoutModal()">&times;</button>
            </div>
            <div class="modal-body" id="terminal-checkout-body">
                <!-- Content will be dynamically populated -->
            </div>
        </div>
    </div>

    <div id="terminal-selection-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fas fa-square"></i> Select Terminal</h3>
                <button class="modal-close" onclick="closeTerminalSelectionModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="terminal-selection-list" class="terminal-device-selector">
                    <!-- Terminal selection will be populated here -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeTerminalSelectionModal()">Cancel</button>
                <button class="btn btn-success" onclick="initiateCartTerminalCheckout()" id="confirm-terminal-btn" disabled>
                    <i class="fas fa-check-circle"></i> Start Checkout
                </button>
            </div>
        </div>
    </div>

    <div id="tender-modal" class="tender-modal">
        <div class="tender-content">
            <h3 style="text-align: center; margin-bottom: 20px;"><i class="fas fa-money-bill-wave"></i> Cash Payment</h3>
            
            <div style="text-align: center; margin-bottom: 10px;">Total Due:</div>
            <div class="tender-amount" id="tender-total-due">$0.00</div>
            
            <input type="number" id="tender-amount" class="tender-input" placeholder="Enter amount received" min="0" step="0.01" autofocus>
            
            <div id="change-display-container" style="display: none;">
                <div style="text-align: center; margin-bottom: 5px;">Change:</div>
                <div class="change-display" id="change-amount">$0.00</div>
            </div>
            
            <div class="action-buttons" style="justify-content: center; margin-top: 20px;">
                <button class="btn btn-secondary" onclick="closeTenderModal()">Cancel</button>
                <button class="btn btn-success" onclick="processCashPayment()" id="complete-payment-btn" disabled>
                    <i class="fas fa-check"></i> Complete Payment
                </button>
            </div>
        </div>
    </div>

    <div id="receipt-modal" class="receipt-modal">
        <div class="receipt-content" id="receipt-content">
            <!-- Receipt will be dynamically generated here -->
        </div>
    </div>

    <div id="print-artists-confirmation-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fas fa-print"></i> Print Artist Names</h3>
                <button class="modal-close" onclick="closePrintArtistsConfirmation()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="print-summary">
                    <h4>Print Summary</h4>
                    <p>You are about to print artist names for <strong id="print-artists-count">0</strong> selected artists.</p>
                    <ul id="print-artists-summary-list">
                        <!-- Will be populated dynamically -->
                    </ul>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closePrintArtistsConfirmation()">Cancel</button>
                <button class="btn btn-success" onclick="confirmPrintArtists()" id="confirm-print-artists-btn">
                    <i class="fas fa-print"></i> Print Now
                </button>
            </div>
        </div>
    </div>

    <div id="accessory-edit-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fas fa-edit"></i> Edit Accessory</h3>
                <button class="modal-close" onclick="closeAccessoryEditModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="accessory-form-grid">
                    <div style="grid-column: 1/-1;">
                        <label for="edit-accessory-description">Description *</label>
                        <input type="text" id="edit-accessory-description" class="filter-select" style="width: 100%;">
                    </div>
                    <div>
                        <label for="edit-accessory-price">Store Price *</label>
                        <input type="number" id="edit-accessory-price" step="0.01" min="0" class="filter-select">
                    </div>
                    <div>
                        <label for="edit-accessory-count">Count</label>
                        <input type="number" id="edit-accessory-count" min="0" class="filter-select">
                    </div>
                </div>
                
                <div class="barcode-preview" id="edit-barcode-preview">
                    <!-- Barcode will be shown here -->
                </div>
                
                <div class="info-message" style="background: #f8f9fa; padding: 10px; border-radius: 4px; margin-top: 10px;">
                    <i class="fas fa-info-circle"></i> Barcode is automatically generated and can't be edited directly. Click "Regenerate Barcode" to create a new one.
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="regenerateAccessoryBarcode()" id="regenerate-barcode-btn">
                    <i class="fas fa-sync-alt"></i> Regenerate Barcode
                </button>
                <button class="btn btn-secondary" onclick="closeAccessoryEditModal()">Cancel</button>
                <button class="btn btn-success" onclick="updateAccessory()">
                    <i class="fas fa-save"></i> Save Changes
                </button>
            </div>
        </div>
    </div>

    <div id="accessory-delete-modal" class="modal-overlay">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fas fa-exclamation-triangle" style="color: #dc3545;"></i> Confirm Delete</h3>
                <button class="modal-close" onclick="closeAccessoryDeleteModal()">&times;</button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete this accessory?</p>
                <p><strong id="delete-accessory-description"></strong></p>
                <p class="info-message" style="background: #f8d7da; color: #721c24; padding: 10px; border-radius: 4px;">
                    <i class="fas fa-exclamation-circle"></i> This action cannot be undone.
                </p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeAccessoryDeleteModal()">Cancel</button>
                <button class="btn btn-danger" onclick="confirmDeleteAccessory()">
                    <i class="fas fa-trash"></i> Delete
                </button>
            </div>
        </div>
    </div>

    <!-- Ship Order Modal -->
    <div id="ship-order-modal" class="modal-overlay">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fas fa-shipping-fast"></i> Mark Order Shipped</h3>
                <button class="modal-close" onclick="ShippingManager.closeShipModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div style="background: #f8f9fa; padding: 15px; border-radius: 4px; margin-bottom: 20px;">
                    <p><strong>Order:</strong> <span id="ship-order-number"></span></p>
                    <p><strong>Record:</strong> <span id="ship-record-title"></span></p>
                    <p><strong>Customer:</strong> <span id="ship-customer-name"></span></p>
                    <p><strong>Address:</strong> <span id="ship-address"></span></p>
                </div>
                
                <div class="filter-group" style="margin-bottom: 15px;">
                    <label for="ship-tracking-number"><i class="fas fa-barcode"></i> Tracking Number:</label>
                    <input type="text" id="ship-tracking-number" class="filter-select" placeholder="Enter tracking number" style="width: 100%;">
                </div>
                
                <div class="filter-group" style="margin-bottom: 15px;">
                    <label for="ship-carrier"><i class="fas fa-truck"></i> Carrier:</label>
                    <select id="ship-carrier" class="filter-select" style="width: 100%;">
                        <option value="USPS">USPS</option>
                        <option value="UPS">UPS</option>
                        <option value="FedEx">FedEx</option>
                        <option value="DHL">DHL</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                
                <div class="info-message" style="background: #e3f2fd; padding: 10px; border-radius: 4px;">
                    <i class="fas fa-info-circle"></i> After marking as shipped, the order will move to the "Shipped" list.
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="ShippingManager.closeShipModal()">Cancel</button>
                <button class="btn btn-success" onclick="ShippingManager.confirmShipOrder()" id="confirm-ship-btn">
                    <i class="fas fa-check"></i> Mark as Shipped
                </button>
            </div>
        </div>
    </div>

    <!-- Order Details Modal -->
    <div id="order-details-modal" class="modal-overlay">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fas fa-receipt"></i> Order Details</h3>
                <button class="modal-close" onclick="ShippingManager.closeOrderDetailsModal()">&times;</button>
            </div>
            <div class="modal-body" id="order-details-content">
                <!-- Will be populated dynamically -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="ShippingManager.printShippingLabel()" id="print-label-btn">
                    <i class="fas fa-print"></i> Print Label
                </button>
                <button class="btn btn-secondary" onclick="ShippingManager.closeOrderDetailsModal()">Close</button>
            </div>
        </div>
    </div>

    <!-- Refund Modal (Enhanced) -->
    <div id="refund-modal" class="modal-overlay">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fas fa-undo-alt"></i> Process Refund</h3>
                <button class="modal-close" onclick="closeRefundModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="refund-receipt-info" style="background: #f8f9fa; padding: 15px; border-radius: 4px; margin-bottom: 20px;">
                    <!-- Receipt info will be populated here -->
                </div>
                
                <div id="refund-items-container" style="margin-bottom: 20px; max-height: 300px; overflow-y: auto;">
                    <!-- Items will be populated here -->
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label for="refund-terminal-select" style="display: block; margin-bottom: 5px; font-weight: 500;">
                        <i class="fas fa-square"></i> Select Terminal (for Square refunds):
                    </label>
                    <select id="refund-terminal-select" class="filter-select" style="width: 100%;">
                        <option value="">Loading terminals...</option>
                    </select>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label for="refund-amount" style="display: block; margin-bottom: 5px; font-weight: 500;">
                        Refund Amount:
                    </label>
                    <input type="number" 
                           id="refund-amount" 
                           class="tender-input" 
                           placeholder="0.00"
                           min="0.01"
                           step="0.01"
                           style="width: 100%;"
                           readonly>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label for="refund-reason" style="display: block; margin-bottom: 5px; font-weight: 500;">
                        Reason:
                    </label>
                    <select id="refund-reason" class="filter-select" style="width: 100%;">
                        <option value="Customer request">Customer request</option>
                        <option value="Defective item">Defective item</option>
                        <option value="Wrong item">Wrong item</option>
                        <option value="Customer changed mind">Customer changed mind</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                
                <div id="refund-error" class="status-message status-error" style="display: none;"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeRefundModal()">Cancel</button>
                <button class="btn btn-warning" onclick="processRefund()" id="process-refund-btn" disabled>
                    <i class="fas fa-undo"></i> Process Refund
                </button>
            </div>
        </div>
    </div>

    <div id="barcode-print-container" style="display: none;"></div>

    <!-- Scripts -->
    <script src="/static/js/app-config.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.6/dist/JsBarcode.all.min.js"></script>
    
    <!-- Admin JavaScript Modules -->
    <script src="/static/js/utils.js"></script>
    <script src="/static/js/config-manager.js"></script>
    <script src="/static/js/add-edit-delete-manager.js"></script>
    <script src="/static/js/price-tags.js"></script>
    <script src="/static/js/checkout.js"></script>
    <script src="/static/js/receipts.js"></script>
    <script src="/static/js/consignors.js"></script>
    <script src="/static/js/artists.js"></script>
    <script src="/static/js/genres.js"></script>
    <script src="/static/js/accessories.js"></script>
    <script src="/static/js/shipping.js"></script>
    <script src="/static/js/refunds.js"></script>

    <script>
        // Tab switching function
        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName + '-tab').classList.add('active');
            
            // Update active tab button
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Load data if needed
            if (tabName === 'shipping') {
                ShippingManager.init();
            } else if (tabName === 'artists') {
                loadArtists();
            } else if (tabName === 'genres') {
                loadGenreMismatches();
            } else if (tabName === 'accessories') {
                loadAccessories();
            } else if (tabName === 'admin-config') {
                loadConfigTables();
            } else if (tabName === 'price-tags') {
                loadRecords();
            } else if (tabName === 'consignors') {
                loadConsignors();
            } else if (tabName === 'receipts') {
                loadReceipts();
            }
        }
        
        // Helper function for escaping HTML
        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // Show status message
        function showStatusMessage(message, type = 'info') {
            // You can implement this based on your existing status message system
            console.log(`[${type}] ${message}`);
        }
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Check if user is logged in and is admin
            Auth.init().then(() => {
                if (!Auth.isLoggedIn || Auth.role !== 'admin') {
                    window.location.href = '/';
                }
            });
        });
    </script>
</body>
</html>