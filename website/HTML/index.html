<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="/static/images/PigStyle.ico">
    <title>PigStyle Music Loveland - Coming Soon</title>
    
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-03HFDR9PV7"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-03HFDR9PV7');
    </script>
    
    <!-- CSS FILE - All styles here -->
    <link rel="stylesheet" href="/static/css/index.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    
    <script src="../static/js/app-config.js"></script>
     
    <!-- JavaScript for expandable photos and commission rate -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Get all store images
            const storeImages = document.querySelectorAll('.store-front, .store-inside');
            const modal = document.querySelector('.expandable-modal');
            const expandedImg = document.querySelector('.expanded-image');
            const imageCaption = document.querySelector('.image-caption');
            const closeModal = document.querySelector('.close-modal');
            
            // Add click event to each image
            storeImages.forEach(img => {
                img.addEventListener('click', function() {
                    // Set the expanded image source
                    expandedImg.src = this.src;
                    
                    // Set the caption based on alt text
                    imageCaption.textContent = this.alt;
                    
                    // Show modal
                    modal.classList.add('active');
                    document.body.classList.add('modal-open');
                });
            });
            
            // Close modal when X is clicked
            closeModal.addEventListener('click', function() {
                modal.classList.remove('active');
                document.body.classList.remove('modal-open');
            });
            
            // Close modal when clicking outside the image
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.classList.remove('active');
                    document.body.classList.remove('modal-open');
                }
            });
            
            // Close modal with Escape key
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && modal.classList.contains('active')) {
                    modal.classList.remove('active');
                    document.body.classList.remove('modal-open');
                }
            });

            // Fetch and display commission rate
            // Now you can simply use AppConfig.getUrl() which will use the correct base URL
            // Fetch and display commission rate
            async function fetchCommissionRate() {
                try {
                    // Check if AppConfig is loaded
                    if (typeof AppConfig === 'undefined') {
                        console.warn('AppConfig not loaded yet, retrying...');
                        // Try again in 500ms
                        setTimeout(fetchCommissionRate, 500);
                        return;
                    }
                    
                    // Get the API URL using AppConfig
                    const apiUrl = AppConfig.getUrl('commissionRate');
                    console.log('Fetching commission rate from:', apiUrl);
                    
                    // Make the API request
                    const response = await fetch(apiUrl, {
                        method: 'GET',
                        headers: {
                            'Content-Type': 'application/json',
                            'Accept': 'application/json'
                        }
                    });
                    
                    if (!response.ok) {
                        throw new Error(`API returned ${response.status}: ${response.statusText}`);
                    }
                    
                    const data = await response.json();
                    
                    // Check if we got the expected data
                    if (data && data.commission_rate_percent) {
                        // Update the consignment item with the commission rate
                        const consignmentItem = document.getElementById('consignment-item');
                        if (consignmentItem) {
                            consignmentItem.innerHTML = 
                                `Sell your record collection on <a href="consignment.html">consignment</a> - Current rate: <strong>${data.commission_rate_percent}</strong>`;
                            console.log('Commission rate displayed:', data.commission_rate_percent);
                        }
                    } else {
                        throw new Error('Invalid response format: missing commission_rate_percent');
                    }
                    
                } catch (error) {
                    console.error('Error fetching commission rate:', error);
                    
                    // Show fallback message
                    const consignmentItem = document.getElementById('consignment-item');
                    if (consignmentItem) {
                        consignmentItem.innerHTML = 
                            `Sell your record collection on <a href="consignment.html">consignment</a> - Rate info currently unavailable`;
                    }
                    
                    // Try direct fetch as fallback (without AppConfig)
                    try {
                        console.log('Trying direct fetch as fallback...');
                        const isLocalhost = window.location.hostname === 'localhost' || 
                                        window.location.hostname === '127.0.0.1';
                        const fallbackUrl = isLocalhost 
                            ? 'http://localhost:5000/api/commission-rate'
                            : `https://${window.location.hostname}/api/commission-rate`;
                        
                        const fallbackResponse = await fetch(fallbackUrl);
                        if (fallbackResponse.ok) {
                            const fallbackData = await fallbackResponse.json();
                            if (fallbackData.commission_rate_percent) {
                                const consignmentItem = document.getElementById('consignment-item');
                                if (consignmentItem) {
                                    consignmentItem.innerHTML = 
                                        `Sell your record collection on <a href="consignment.html">consignment</a> - Current rate: <strong>${fallbackData.commission_rate_percent}</strong>`;
                                }
                            }
                        }
                    } catch (fallbackError) {
                        console.error('Fallback also failed:', fallbackError);
                    }
                }
            }

            // Call the function to fetch and display commission rate
            fetchCommissionRate();
        });
    </script>
</head>

<body>
    <!-- Navbar -->
    <nav style="background: #000; padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; position: fixed; top: 0; left: 0; right: 0; z-index: 1000; border-bottom: 2px solid #ff6b6b;">
        <a href="/" style="color: white; text-decoration: none; font-size: 20px; font-weight: bold; display: flex; align-items: center; gap: 10px;">
            <img src="/static/images/PigStyle.ico" alt="PigStyle" style="height: 30px; width: 30px;">
            PigStyle Music
        </a>
        <div style="display: flex; gap: 20px; align-items: center;">
            <a href="/catalog" style="color: white; text-decoration: none;">Catalog</a>
            <a href="/streaming" style="color: white; text-decoration: none;">Streaming</a>
            <a href="/consignment" style="color: white; text-decoration: none;">Consignment</a>
            <div id="auth-section">
            </div>
        </div>
    </nav>

    <!-- Add padding to account for fixed navbar -->
    <div style="padding-top: 60px;"></div>

    <!-- Background Image -->
    <div class="background-container">
        <img src="/static/images/background.png" alt="Background" class="background-image">
        <div class="background-overlay"></div>
    </div>

    <!-- "Not in Business Yet" Banner -->
    <div class="banner">
        <p>ðŸš§ Not open yet...Opening February 21!   ðŸš§</p>
    </div>

    <!-- Expandable Image Modal -->
    <div class="expandable-modal">
        <div class="expanded-image-container">
            <button class="close-modal">&times;</button>
            <img class="expanded-image" src="" alt="Expanded view">
            <div class="image-caption"></div>
        </div>
    </div>

    <!-- Main Content Container -->
    <div class="container">
        <!-- Top Section - Logo and Title -->
        <div class="top-section">
            <img src="/static/images/pigstyle_text.png" alt="PigStyle" class="pigstyle-logo">
            <div class="psychedelic-subscript">
                <img src="/static/images/loveland_record_store.png" alt="Loveland's Coolest Record Store">
            </div>
        </div>

        <!-- Content Box with Bulleted List -->
        <div class="content-box">
            <ul>
                <li>
                    <div class="image-text-wrapper">
                        <img src="/static/images/StoreFront.jpg" alt="PigStyle Store Front" class="store-front">
                        <img src="/static/images/StoreInside1.jpg" alt="Inside PigStyle Store" class="store-inside">
                        <img src="/static/images/StoreInside2.jpg" alt="Inside PigStyle Store" class="store-inside">
                    </div>
                </li>
                <li>
                    Browse music <a href="catalog.html">here</a>
                </li>
                <li>
                    Find your next favorite album on my <a href="streaming.html">vinyl streaming station</a>
                </li>
                <li id="consignment-item">
                    Sell your record collection on <a href="consignment.html">consignment</a>
                </li>
            </ul>
        </div>

        <!-- Bottom Section - Record and Store Info -->
        <div class="bottom-section">
            <div class="record-container">
                <img src="/static/images/pig_head.png" alt="Pig Head" class="pig-head">
                <img src="/static/images/yellow-record.png" alt="Spinning Record" class="rotating-record">
            </div>
            
            <div class="store-info">
                <p>Address: 100 E 3rd Loveland CO</p>
                <p>Hours: Mon-Sat 10am - 6pm, Sun 12pm - 6pm</p>
                <p>Phone: 970-492-5630</p>
                <p>Email: pigstyle.loveland@gmail.com</p>
                <div class="social-icons">
                    <a href="#" target="_blank" aria-label="Visit our Facebook page"><i class="fab fa-facebook"></i></a>
                    <a href="#" target="_blank" aria-label="Visit our Instagram page"><i class="fab fa-instagram"></i></a>
                </div>
            </div>
        </div>
    </div>
</body>
</html>